class App{constructor(){}init(){this.initTattooAnimation(),this.handlePreloader()}initTattooAnimation(){this.tattoo=new TattooAnimation("#tattoo-canvas",{imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:20,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3})}handlePreloader(){window.addEventListener("load",()=>{setTimeout(()=>{const t=document.querySelector('[data-element="preloader"]');t&&t.classList.add("is-loaded"),document.body.classList.remove("is-overflow")},3e3)})}}class TattooAnimation{constructor(t,i={}){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d"),this.dpr=window.devicePixelRatio||1,this.parentElement=this.canvas.closest(".hero__preview"),this.parentElement||console.error("Родительский элемент .hero__preview не найден для канваса.");this.options={fps:2,imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:100,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3,...i},this.FPS=this.options.fps,this.FRAME_INTERVAL=1e3/this.FPS,this.frames=[],this.currentFrameIndex=0,this.lastTimestamp=0,this.isIntersecting=!1,this.animationFrameId=null,this.boundAnimate=this.animate.bind(this),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.setupIntersectionObserver(),this.loadAllFramesAndStart()}resizeCanvas(){const t=this.canvas.getBoundingClientRect();let i=Math.min(t.width,this.options.maxCanvasLogicalWidth)*this.dpr,e=Math.min(t.height,this.options.maxCanvasLogicalHeight)*this.dpr;const s=this.frames[this.currentFrameIndex];if(s){const t=s.width/s.height;t>i/e?e=i/t:i=e*t}this.canvas.width===i&&this.canvas.height===e||(this.canvas.width=i,this.canvas.height=e,this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0),this.isIntersecting&&this.frames.length>0&&this.drawFrame(this.frames[this.currentFrameIndex]))}loadImage(t){return new Promise((i,e)=>{const s=new Image;s.onload=()=>i(s),s.onerror=()=>e(new Error(`Image not found: ${t}`)),s.src=t})}drawFrame(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const i=this.canvas.width/this.dpr,e=this.canvas.height/this.dpr;let s,a,n,r;t.width/t.height>i/e?(a=e,s=t.width*(e/t.height),n=(i-s)/2,r=0):(s=i,a=t.height*(i/t.width),n=0,r=(e-a)/2),this.ctx.drawImage(t,n,r,s,a)}async loadAllFramesAndStart(){const t=[];for(let i=0;i<this.options.maxFramesToCheck;i++){const e=this.options.imagePathPattern(i);t.push(this.loadImage(e))}const i=await Promise.allSettled(t),e=[];let s=0;for(let t=0;t<i.length;t++){const a=i[t];if("fulfilled"!==a.status){console.warn(`Stopped loading at missing frame: ${this.options.imagePathPattern(t)}`,a.reason);break}e.push(a.value),s++}0!==s?(this.frames=e,this.drawFrame(this.frames[0]),this.parentElement&&this.parentElement.classList.add("is-ready"),this.isIntersecting&&(this.animationFrameId=requestAnimationFrame(this.boundAnimate))):console.error("Не удалось загрузить ни одного кадра.")}animate(t){if(this.isIntersecting&&this.frames.length>0){this.lastTimestamp||(this.lastTimestamp=t);t-this.lastTimestamp>=this.FRAME_INTERVAL&&(this.drawFrame(this.frames[this.currentFrameIndex]),this.currentFrameIndex=(this.currentFrameIndex+1)%this.frames.length,this.lastTimestamp=t)}this.isIntersecting?this.animationFrameId=requestAnimationFrame(this.boundAnimate):this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}setupIntersectionObserver(){if(!("IntersectionObserver"in window))return this.isIntersecting=!0,void console.warn("IntersectionObserver не поддерживается.");new IntersectionObserver(t=>{t.forEach(t=>{this.isIntersecting=t.isIntersecting,this.isIntersecting&&!this.animationFrameId?(this.lastTimestamp=0,this.animationFrameId=requestAnimationFrame(this.boundAnimate)):!this.isIntersecting&&this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)})},{root:null,rootMargin:"0px",threshold:.1}).observe(this.canvas)}}document.addEventListener("DOMContentLoaded",()=>{(new App).init()});//# sourceMappingURL=main.min.js.map
