class TattooAnimation{constructor(t,i={}){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d"),this.dpr=window.devicePixelRatio||1,this.parentElement=this.canvas.closest(".hero__preview"),this.parentElement||console.error("Родительский элемент .hero__preview не найден для канваса.");this.options={fps:3,imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:100,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3,...i},this.FPS=this.options.fps,this.FRAME_INTERVAL=1e3/this.FPS,this.frames=[],this.currentFrameIndex=0,this.lastTimestamp=0,this.isIntersecting=!1,this.animationFrameId=null,this.boundAnimate=this.animate.bind(this),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.setupIntersectionObserver(),this.loadAllFramesAndStart()}resizeCanvas(){const t=this.canvas.getBoundingClientRect();let i=Math.min(t.width,this.options.maxCanvasLogicalWidth)*this.dpr,s=Math.min(t.height,this.options.maxCanvasLogicalHeight)*this.dpr;const e=this.frames[this.currentFrameIndex];if(e){const t=e.width/e.height;t>i/s?s=i/t:i=s*t}this.canvas.width===i&&this.canvas.height===s||(this.canvas.width=i,this.canvas.height=s,this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0),this.isIntersecting&&this.frames.length>0&&this.drawFrame(this.frames[this.currentFrameIndex]))}loadImage(t){return new Promise((i,s)=>{const e=new Image;e.onload=()=>i(e),e.onerror=()=>s(new Error(`Image not found: ${t}`)),e.src=t})}drawFrame(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const i=this.canvas.width/this.dpr,s=this.canvas.height/this.dpr;let e,a,n,r;t.width/t.height>i/s?(a=s,e=t.width*(s/t.height),n=(i-e)/2,r=0):(e=i,a=t.height*(i/t.width),n=0,r=(s-a)/2),this.ctx.drawImage(t,n,r,e,a)}async loadAllFramesAndStart(){const t=[];for(let i=0;i<this.options.maxFramesToCheck;i++){const s=this.options.imagePathPattern(i);t.push(this.loadImage(s))}const i=await Promise.allSettled(t),s=[];let e=0;for(let t=0;t<i.length;t++){const a=i[t];if("fulfilled"!==a.status){console.warn(`Stopped loading at missing frame: ${this.options.imagePathPattern(t)}`,a.reason);break}s.push(a.value),e++}0!==e?(this.frames=s,this.drawFrame(this.frames[0]),this.parentElement&&this.parentElement.classList.add("is-ready"),this.isIntersecting&&(this.animationFrameId=requestAnimationFrame(this.boundAnimate))):console.error("Не удалось загрузить ни одного кадра.")}animate(t){if(this.isIntersecting&&this.frames.length>0){this.lastTimestamp||(this.lastTimestamp=t);t-this.lastTimestamp>=this.FRAME_INTERVAL&&(this.drawFrame(this.frames[this.currentFrameIndex]),this.currentFrameIndex=(this.currentFrameIndex+1)%this.frames.length,this.lastTimestamp=t)}this.isIntersecting?this.animationFrameId=requestAnimationFrame(this.boundAnimate):this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}setupIntersectionObserver(){if(!("IntersectionObserver"in window))return this.isIntersecting=!0,void console.warn("IntersectionObserver не поддерживается.");new IntersectionObserver(t=>{t.forEach(t=>{this.isIntersecting=t.isIntersecting,this.isIntersecting&&!this.animationFrameId?(this.lastTimestamp=0,this.animationFrameId=requestAnimationFrame(this.boundAnimate)):!this.isIntersecting&&this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)})},{root:null,rootMargin:"0px",threshold:.1}).observe(this.canvas)}}const tattoo=new TattooAnimation("#tattoo-canvas",{imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:20,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3});//# sourceMappingURL=main.min.js.map
