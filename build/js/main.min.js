class TattooAnimation{constructor(t,s={}){this.canvas=document.querySelector(t),this.ctx=this.canvas.getContext("2d"),this.dpr=window.devicePixelRatio||1,this.parentElement=this.canvas.closest(".hero__preview"),this.parentElement||console.error("Родительский элемент .hero__preview не найден для канваса. Фолбэк-логика может работать некорректно.");this.options={fps:3,imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:100,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3,...s},this.FPS=this.options.fps,this.FRAME_INTERVAL=1e3/this.FPS,this.frames=[],this.currentFrameIndex=0,this.lastTimestamp=0,this.isPaused=!1,this.isIntersecting=!1,this.animationFrameId=null,this.boundAnimate=this.animate.bind(this),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.addInteractionListeners(),this.setupIntersectionObserver(),this.loadAllFramesAndStart()}resizeCanvas(){const t=this.canvas.getBoundingClientRect();let s=Math.min(t.width,this.options.maxCanvasLogicalWidth)*this.dpr,i=Math.min(t.height,this.options.maxCanvasLogicalHeight)*this.dpr;const e=this.frames[this.currentFrameIndex];if(e){const t=e.width/e.height;t>s/i?i=s/t:s=i*t}this.canvas.width===s&&this.canvas.height===i||(this.canvas.width=s,this.canvas.height=i,this.ctx.setTransform(this.dpr,0,0,this.dpr,0,0),this.isIntersecting&&this.frames.length>0&&this.drawFrame(this.frames[this.currentFrameIndex]))}loadImage(t){return new Promise((s,i)=>{const e=new Image;e.onload=()=>s(e),e.onerror=()=>i(new Error(`Image not found: ${t}`)),e.src=t})}drawFrame(t){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const s=this.canvas.width/this.dpr,i=this.canvas.height/this.dpr;let e,a,n,h;t.width/t.height>s/i?(a=i,e=t.width*(i/t.height),n=(s-e)/2,h=0):(e=s,a=t.height*(s/t.width),n=0,h=(i-a)/2),this.ctx.drawImage(t,n,h,e,a)}async loadAllFramesAndStart(){const t=[];for(let s=0;s<this.options.maxFramesToCheck;s++){const i=this.options.imagePathPattern(s);try{const s=await this.loadImage(i);t.push(s)}catch(t){console.warn(`Stopped loading at missing frame: ${i}`);break}}0!==t.length?(this.frames=t,this.drawFrame(this.frames[0]),this.parentElement&&this.parentElement.classList.add("is-ready"),this.isIntersecting&&(this.animationFrameId=requestAnimationFrame(this.boundAnimate))):console.error("Не удалось загрузить ни одного кадра. Фолбэк-изображение останется видимым.")}animate(t){if(this.isIntersecting&&!this.isPaused&&this.frames.length>0){this.lastTimestamp||(this.lastTimestamp=t);t-this.lastTimestamp>=this.FRAME_INTERVAL&&(this.drawFrame(this.frames[this.currentFrameIndex]),this.currentFrameIndex=(this.currentFrameIndex+1)%this.frames.length,this.lastTimestamp=t)}this.isIntersecting?this.animationFrameId=requestAnimationFrame(this.boundAnimate):this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}setupIntersectionObserver(){if(!("IntersectionObserver"in window))return this.isIntersecting=!0,void console.warn("IntersectionObserver не поддерживается. Анимация может работать непрерывно.");new IntersectionObserver(t=>{t.forEach(t=>{this.isIntersecting=t.isIntersecting,this.isIntersecting?this.animationFrameId||(this.lastTimestamp=0,this.animationFrameId=requestAnimationFrame(this.boundAnimate)):this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)})},{root:null,rootMargin:"0px",threshold:.1}).observe(this.canvas)}addInteractionListeners(){this.canvas.addEventListener("mousedown",()=>this.isPaused=!0),this.canvas.addEventListener("mouseup",()=>this.isPaused=!1),this.canvas.addEventListener("mouseleave",()=>this.isPaused=!1),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.isPaused=!0},{passive:!1}),this.canvas.addEventListener("touchend",()=>this.isPaused=!1),this.canvas.addEventListener("touchcancel",()=>this.isPaused=!1)}}const tattoo=new TattooAnimation("#tattoo-canvas",{imagePathPattern:t=>`assets/images/slides/${t}.jpg`,maxFramesToCheck:100,maxCanvasLogicalWidth:1e3,maxCanvasLogicalHeight:1e3});//# sourceMappingURL=main.min.js.map
